# 2. 用户权限

## 1. Linux中的用户与组

`linux`是一个多用户系统，为了便于管理多个用户，又产生了用户组。

- 每个用户都有唯⼀的用户名，并且 Linux 会分配一个唯⼀的`UID`与之对应。
- 同样每个用户组也有唯一的名称，Linux 会分配一个唯⼀的`GID`给每一个用户组。
- root 用户的`uid`和`gid`都是 0
- 用户名与`UID`的对应关系在`/etc/passwd`中
- 用户组与`GID`的对应关系记录在`/etc/group`中
- 用户的密码信息记录在`/etc/shadow`

### 1. `passwd`格式

- 单行样例：`root:x:0:0:root:/root:/bin/bash`

- 详情

  | 列        | 说明                         |
  | :-------- | ---------------------------- |
  | root      | 用户名                       |
  | x         | 早期曾在此记录密码，现已作废 |
  | 0         | `UID`                        |
  | 0         | `GID`                        |
  | root      | 注释                         |
  | /root     | 家目录                       |
  | /bin/bash | 登录后所使用的Shell          |

### 2. shadow格式

- 单行样例：  `root:$1$lrKCOpzq$IHP2BuuKxMdLaBw/:17877:0:99999:7:::`

- 详情

  | 列                             | 说明                                             |
  | ------------------------------ | ------------------------------------------------ |
  | root                           | 用户名                                           |
  | `$1$lrKCOpzq$IHP2BuuKxMdLaBw/` | 密码                                             |
  | 17877（天数）                  | 最后一次修改密码的⽇日期(该数字从1970-1-1开始记) |
  | 0                              | 密码⼏几⽇日内不不可修改(为0表示可以随时修改)    |
  | 99999                          | 密码有效天数                                     |
  | 7                              | 密码失效前⼏几天内提醒⽤用户修改密码             |
  |                                | 密码失效的宽限天数                               |
  |                                | 账号失效⽇日期                                   |
  |                                | 保留留字段，暂时没⽤用                           |

### 3. group格式

- 单行样例：`  wheel:x:10:bob,tom`

- 详情

  | 列      | 说明           |
  | ------- | -------------- |
  | wheel   | 组名           |
  | x       | 组密码(已弃用) |
  | 10      | 组ID(`GID`)    |
  | bob,tom | 该组的成员     |

## 2. 用户管理

### 1. `useradd`指令——创建新用户

- 语法：`useradd` [选项] [参数]
- 功能介绍：`useradd`指令**用于Linux中创建新的系统用户**
- 常用选项
  - -G		指定用户所属的附加值
  - -m       在  /home 目录创建用户的家目录
  - -U       创建与用户同名的组
  - -p        加密后的新账户密码 / 指定密码（已加过密的）
- 例子         `useradd -mU -G 组名 -p 密码 用户名`

### 2. `userdel`指令——删除用户及相关文件

- 语法：`userdel`  [选项] [参数]
- 功能介绍：`userdel`指令**用于删除给出的用户**，以及与用户相关的文件
- 常用选项 
  - -r		删除主目录和邮件池
  - -f        强制删除用户，即使用户当前已登录
- 例子       `userdel -rf ⽤用户名`

### 3. `passwd`指令——设置用户密码

- 语法：`passwd` [选项] [参数]
- 功能介绍：`passwd`指令**用于设置用户的认证信息**，包括用户密码、密码过期时间等
- 例子  `passwd 用户名`

### 4. `su`指令——切换用户身份

- 语法：`su`  [选项] [参数]
- 功能介绍：`su`指令**用于切换当前用户身份到其他用户身份**
- 常用说明
  - -g		指定主要组
  - -G       指定附加组
  - -c        传递单个指令给shell
  - -m       不重新设置环境变量
- 例子      
  - `su 用户名` : 仅切换用户身份  
  - `su - 用户名` : 完全以这个用户进行登录，会初始化当前用户的设置

### 5. id指令——查看用户和组的信息

- 用法1：  id 查看用户个人的 uid、gid、组信息
- 用法2：  id -u 查看用户的 uid
- 用法3：  id -g 查看用户的 gid

## 3. 用户组管理

### 1. `groupadd`指令——创建新工作组

- 语法：`groupadd` [选项] [参数]
- 功能介绍：`groupadd`指令**用于创建新工作组**，新工作组的信息将被添加到系统文件中
- 常用选项
  - `-g GID`				为新组使用`GID`
  - -p PASSWORD     为新组使用此加密过的密码
  - -r                           创建系统工作组

### 2. `groupdel`指令——删除工作组

- 语法：`groupdel` [参数]
- 功能介绍：`groupdel`指令**用于删除给定的工作组**，本指令要修改的系统文件包括“`/etc/group`”和“`/etc/gshadow`”

### 3. `usermod`指令——修改用户

- 语法：`usermod` [选项] [参数]
- 功能介绍：`usermod`指令用于修改用户的基本信息
- 常用选项
  - -d HOME_DIR : 用户的新主目录
  - -g GROUP : 强制使用 GROUP 为新主组
  - -G GROUPS : 新的附加组列表 GROUPS
  - -a GROUP : 将用户追加至上边 -G 中提到的附加组中，并不从其它组中删除此用户
  - -L : 锁定用户帐号
  - -m : 将家目录内容移至新位置 (仅于 -d 一起使用)
  - -s SHELL : 该用户帐号的新登录 shell
  - -U : 解锁用户帐号

## 4. 查看登录的用户

| 指令    | 说明                                               |
| :------ | -------------------------------------------------- |
| who     | 查看谁正在登录                                     |
| w       | 查看谁正在登录，并在显示每个登陆用户正在执行的任务 |
| last    | 查看历史登陆记录                                   |
| lastb   | 查看失败的登陆记录                                 |
| lastlog | 查看全部用户最后一次登陆的时间                     |

## 5. 文件权限

### 1. 权限的定义

Linux 为文件或目录设置了三种权限:

| 标签 | 含义              |
| ---- | ----------------- |
| r    | read，读权限      |
| w    | write，写权限     |
| x    | execute，执行权限 |

同时又规定了不同身份的用户对该文件的权限，用户身份分三种:

- user	文件拥有者
- group  同组人
- other   其他人

使用`ls -l`可以看到文件的权限信息

```
-rwxr-xr-- 1 bob staff 9824 8 28 21:22 test.py
-rw-r--r-- 1 tom staff 10787 8 27 12:57 01.md
-rw-r----- 1 tom staff 5053 8 28 23:42 sun.jpg
```

### 2. 权限修改

- #### 通过符号修改权限

| 指令  | 选项    |                         | 文件  | 文件       |
| ----- | ------- | ----------------------- | ----- | ---------- |
| chmod | u/g/o/a | +(加入)/-(除去)/=(设定) | r/w/x | 文件或目录 |

- #### 通过数字修改权限

- 例子  ` chmod 753 test.py`

### 3. chown指令——改变文件的所有者和所属工作组

- 语法：chown [选项] [参数]
- 功能介绍：chown指令**用来改变文件的所有者和所属的工作组**。如果参数中只提供用户名，那么文件所属的工作组不发生任何变化；如果同时提供用户名和所属工作组，用户名和所属工作组之间使用冒号或者点隔开，那么文件的所属用户和所属工作组将同时改变
- 常用选项
  - -R或者--recursive  	递归操作，依次修改指定目录及其目录下所有内容的所有者和所属工作组
- 例子      `  chown 用户:组 文件`

## 6. 文本操作

### 1. echo指令——打印变量或字符串

- 语法：echo [选项] [参数]
- 功能介绍：echo 指令**用于在shell中打印shell变量的值，或者直接输出指定的字符串**
- 常用选项：-c    激活转义字符
- 例子 
  - echo xyz : 打印⽂文本
  - echo xyz > a.txt : 将输出的⽂文本重定向到⽂文件a.txt中，a.txt原有内容会被覆盖
  - echo xyz >> a.txt : 将输出的⽂文本追加到⽂文件a.txt中，a.txt原有内容不不会被覆盖

### 2. cat指令——连接文件并显示内容

- 语法：cat [选项] [参数]
- 功能介绍：cat指令**用于将多个文件连接，并将结果通过标准输出显示出来**
- 常用选项：
  - -b		在空行前面显示行号
  - -n        显示所有行的行号，包括空行
- 例子    cat ⽂文件名 : 查看⽂文件

### 3. head指令——显示文件的头部内容

- 语法：head  [选项] [参数]
- 功能介绍：head指令**用于显示文件的开头部分的内容**。默认情况下，head指令显示文件的头10行内容
- 常用选项
  - -n<行数>		指定显示头部内容的行数
  - -c<字符数>     指定显示头部内容的字符数
- 例子     head -n N 文件名 : 查看文件的前 N ⾏

### 4. tail指令——输出文件尾部内容

- 语法：tail [选项] [参数]
- 功能介绍：tail指令**用于输出文件中的尾部内容**
- 常用选项
  - -n 		输出文件的尾部N行内容
  - -c          输出文件尾部的N个字节内容
- 例子      tail -n N 文件名 : 查看文件的后 N 行

### 5. less指令——分屏显示文件内容

- 语法：less [选项] [参数]
- 功能介绍：less指令**用来分屏查看文件内容**，它的功能与more指令类似，但是比more指令更加强大，支持各种显示终端，支持向后查看已经显示过得文件内容。less指令在显示文件内容时，并不是一次将整个文件加载之后才显示，而是根据显示需要加载内容，对于显示大型文件具有较高的效率
- 常用选项
  - 按 j 向下          
  - 按 k 向上
  - 按 f 向下翻屏
  - 按 b 向上翻屏
  - 按 g 到全文开头
  - 按 G 到全文结尾
  - 按 q 退出
  - -N  每一行首显示行号
- 例子     less  文件 : 快速浏览文件

### 6. sort指令——对文件进行行排序

- 语法：sort  [选项] [参数]
- 功能介绍：**sort指令将文件进行排序，并将排序结果输出的标准输出设备**
- 常用选项
  - -n 	根据字符串表示的数字值进行排序
  - -r      反序排序
- 例子       
  - sort 文本或文件 : 将结果按升序排序
  - sort -r 文本或文件 将结果按降序排序

### 7. uniq指令——报告或忽略文件中的重复行

- 语法：uniq [选项] [参数]
- 功能介绍：uniq指令**用于报告或忽略文件中的重复行**（相邻的）
- 常用选项：
  - -c 	在行首显示该行重复出现的次数
  - -d     仅输出文件中重复行的内容。重复的行只输出一次
- 例子     uniq 去重, 依赖排序, 常跟在 sort 后面使⽤

### 8. awk指令

- awk '{print $N}' 打印出相关列

### 9. wc指令——统计文件的字节数、单词数和行数

- 语法：wc [选项] [参数]
- 功能介绍：wc指令**用于统计文本文件的字节数、单词数和行数信息**
- 常用选项
  - -c		统计字节数（字符）
  - -w       打印单词数
  - -l         打印行号
- 例子    wc -l abc.py        统计代码行数

### 10. 管道符：|

- 管道符可以连接两个命令，将前面的输出作为后面的输入

## 7. Vim

> VIM 是终端下最常⽤的编辑器，有 “编辑器之神” 之称，简洁⽽强⼤！ 
>
> VIM 分为三种模式：**命令模式，插⼊模式，底栏命令模式** 

- ### 按 esc 键，进⼊命令模式 

  - h, j, k, l 光标左、下、上、右移动 
  - ctl + e 向下滚动 
  - ctl + y 向上滚动 
  - ctl + f 向下翻屏 
  - ctl + b 向上翻屏 
  - yy 复制整⾏
  - yw 复制整⾏ 
  - p(小写) 粘贴到下⼀⾏ 
  - P(大写) 粘贴到上⼀⾏ 
  - dd 删除整⾏ 
  - d3w 向前删除3个单词 
  - 7x 删除7个字符 
  - u 撤销 
  - ctl + r 重做 
  - c3w 剪切3个单词 
  - gg 跳⾄⽂件⾸⾏ 
  - shift + g 跳⾄⽂件结尾 
  - shift + h 跳⾄屏幕⾸⾏ 
  - shift + m 跳⾄屏幕中间 
  - shift + l 跳⾄屏幕结尾 

- ctl + v 列编辑 

  - shift + v 选中整列 
  - shift + > 向右缩紧 
  - shift + < 向左缩紧 

- ### 按 i 键，进⼊插⼊模式 

  - 插⼊模式下正常输⼊即可 
  - 想做其他操作，必须先按 ESC 键回到命令模式 

- ### 在命令模式时按 : 键，进⼊底栏命令模式 

  - 23 跳⾄⽂件的第 23 ⾏ 
  - %s/abc/123/g 把⽂件中所有的 abc 替换成 123 
  - set nu 打开⾏号 
  - set nonu 关闭⾏号 
  - w 保存 
  - q 退出 
  - wq 保存并退出 

- ### vim 配置⽂件 ~/.vimrc 

- ### 备注 

  - https://coolshell.cn/articles/5426.html 
  - http://www.oschina.net/question/615783_148433 
  - 我的 vimrc https://raw.githubusercontent.com/seamile/rc.d/master/vimrc

